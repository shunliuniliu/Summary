# ML-Quant
- （通过询问招商财富某前辈，确定了当数据量少，缺失值过多时，遗传算法可以用于增加、补充数据，但是具体操作时有些关键技巧不方便透露）
- （国内有两家公司实际在做外汇量化交易，但是由于管制，资金实际在香港，而不是在境内）
- （无论策略有多么理想，一定要保证可以承受，出现及其意外的情况时的最大损失。一次输光可以接受，但一定要有保证能翻身的机会）
- （国外彭博Bloomberg可以提供不同实时级别的数据，包括舆情等非结构化的数据，以便于用于高频交易等等。但是国内目前缺少可以匹配的数据提供商。自己做舆情靠搭建爬虫系统，不可取，因为网上信息已经没有了实效性）

### 量化投资的定义

**(1)**  “传统投资是通过信息和个人判断来产进行管理，如果遵循固定规则，由计算机模型产生投资决策则可被视为数量化投资。

​                                                                                    ——Fabozzi(Challenges In Quantitative Equity Management)


**(2)**在现实应用中，量化投资柱往与基本面投简、技术面分析有机结合

**(3)** 量化资是以定量方法进行投资的各种技术综合，遵循套利理念（寻找价值洼地），以概率取胜（以一组而不星一只或几种股票）

### 传统投资分析方法：基本面

| **宏观分析** | **行业分析** | **微观分析** |
| ------ | ------ | ------ |
| 货币政策 | 行业划分 | 主营业务及行业地位分析 |
| 财改政策 | 市场结构分析 | 股本及股东情况 |
| 政治、军事因索 | 竞争结构分析 | 盈利能力分析 |
| GDP | 行业生命周期 | 短期偿债能力 |
| 失业率 | 技术进步 | 长期偿债能力 |
| 商品房销售 | 政府政策 | 经营效率 |
| CPI | …… | 股利政策 |
| PPI | …… | 现金流量分析 |
| …… | …… | …… |


### 传统投资分析方法: 技术面

#### 技术分析的假定前提：

（一）市场行为通盖一D信息

（二）价格沿一定趋运行

（三）历史会在相似的背景下重演

#### 常见的技术面分析方法

日本蜡烛图技术

艾路特波浪理论

MACD金叉买入死叉卖出

放量上涨买入、放量滞涨卖出

KDJ金叉买入死叉卖出

BOLL通道超卖买进超买卖出

……



### 量化投资的应用场景

#### 投资标的

1. 按照投资期限划分
   - 长期
   - 短期
   - 日内高频
2.  按照投资标的划分
   - 权益类资产
   - 固定收益类资产
   - 商品期货类资产
   - ………….
3. 按照投资目标划分
   - 绝对收益目标
   - 相对收益目标



### 量化投资技术

#### 历史数据

- 历史行情数据
- 历史财务数据
- 历史研究、舆情、公告
- 历史交易记录
- ……….

#### 经典统计学方法论

- 将数据结构化，提取特征
- 按照特定逻辑，通过统计方法对特征建立模型
  -  因子选股: 统计因子IC（信息系数）等指标，传统的因子模型也是基于对收益率的先行回归
  - 择时策略: 统计信号的胜率、赔率、频率，并在样本内样本外作比对
  - 交易策略：包括但不限于择时
  - 风险控制：绩效分析时基于线性模型的，其他的风险控制手段也是基于一些风险特征在历史上的表现

#### 量化投资

- 将基于历史数据的统计模型应用与当时的投资问题
- **为什么模型会失效？**
  - 历史不重演了？
    -  历史不会完全重演
    - 模型时历史的，不完全表述未来


- 我们认为，除非市场出现重大变故，否则历史规律不会发生断崖式的变化，而连续变化的历史规律时可以捕捉的。虽然历史不会完全重演，但量化投资仅需要把握部分重演的历史

- 让模型更好地表述历史，预测未来，时量化投资的研究方向

 

### 传统投资VS量化投资

#### 传统投资与化投资的相同点

本质相同，都是基于市场非有效或是码有效的理论某磁，以此获得收益

#### 传统投资的局限性：

在量化投资兴起之前，市场上一直行的是以巴菲“价值投简“为代表的定性投，定性投资对资者的个人素质要求较高，需要投演者具备极至的市场动力向随判力，同时还要以大量的投资经验，具有一定的主观性，风险太大，收益率不确定。

#### 量化投资的优势

随着信息技术和计算机技术的发層，显化根高逐新兴起，它通过建立合适的数学型，通过对大量数的分析，准确的把市场趋势和东西，一切交易都计机程序指令完成，排除了人为的认知偏差和主观判断，同时，通过计算机进行精准的操作，极大地降低了风险，保证了投资的收益率

**值得注意的是**，量化投资存在看模型同质化的问题，大量投资者采用相同的投高策略进行交易，可能会导致失效，其次，由于市场环境不断地发生变化，量化投资不是一劳永逸，需要不断地修正改进，量化投资无法完全代替人脑。

### 人工智能（A）的定义和意义

#### AI

- **思考**

  - 像人一样思考
  - 合理地思考

- **行动**

  - 像人一样行动

    - Natural Language Processing（自然语有处理

      思考

    - Knowledge Representation（知识表示）

    - Automated Reasoning（自动推理）

    - Maching Learning（机器学习）

    - Computer Vision（计算机视觉）

    - Robotics（机器人学）

  - 合理地行动

    - 合理行为主体（ Rational Agent）


#### 机器学习定义

**通俗定义**

利用计算手段，从经验（数据）中建立模型，该模型可用于对新的数据进行判断

**学术定义**

假设用P来评估计算机程序在某任务类T上的性能，若一个程序通过利用经验E在T中任务上获得了性能改善，则我们就说关于和P，该程序对E进行了学习［ Mitchell1997]

#### 机器学习主要算法

- 按有无标记信息
  - 监督学习
  - 非监督学习
  - 半监督学习
  - 强化学习（reinforcement learning）


- 按数据给予方式
  - 批量学习
  - 在线学习


- 按有无建模
  - 基于案例学习
  - 基于模型学习



### 机器学习算法分类

- 机器学习主要分为三种类型，监督学习、无监督学习和强化学习
- 监督学习的主要目的是使用有类标的训练数据构建模型，可以使用经训得到的模型对未来数据进行须质测
- 在无监督学习中，将处理无类标数据或总体分布趋势不明朗的数据，通过无监督学习，我们可以在没有已知输出变量和反馈函数指导的情况下提取有效信息来探索数据的整体结构
- 强化学习的目标是构建一个系统，在与环境交互的过程中提高系统性能通过与环境的交互，系统可以通过强化学习来得到一系列行为，通过探索性试错或激励系统使得正向反馈最大化



| **应用场景** | **机器学习方法** |
| ------ | ------ |
| 市场状态转换模型 | 隐马尔可夫模型，条件随机场 |
| 多因子组合  | 线性回归，Lasso回归，决策树模型 |
| 新闻文本，舆情分析 | 自然语言处理，文本挖掘 |
| 证券买卖定价模型  | 卡尔曼滤波|
| 金融经济数据挖掘 |  神经网络，深度学习 |
| 股价预测的特征提取 | 特证工程，PCA |
| 股价走势顶测 | SVM，决策树，随机森林 |
| 因子模式分类 |  kmeans |

### 监督学习实例一決策树对沪深300走势分类(可用于理论研究，月频的模型不实用)

- 模型构建
  - 模型的输入因子选取了三个大类，分别是市场前期走势、宏观经済指标和利率因素。
  - 市场走势中选取沪深300指数上一个月收益率、上个月区间波动率作为因子，以期反映市场在波动、动量等维度的信息；在宏观经济指标中，选取了GDP（国民经济生产总值，当季同比）、CPI（消费者物价指数）、PM（采购经理人指数）、 Capital Investment（固定资产投资完成额，当月同比）等与A股市场关系密切的变量作为因子；在利率因素中则选取了YTM1Y（1年期国债到期收益率，当月同比）、M2（广义货币，当月同比）
  - 时间区间为2005年1月至2017年7月，训练时间为36个月，采用滚动训练预测的方式用T－36到T－1月的因子数据作为训练样本，进行样本内的参数测算，再用其来预测第T个月沪深300指数的涨跌。


- 所有数据都进行了异常值、缺失值预处理，在每个月的月末判断下个月沪深300指数的涨跌，并将该结果与下个月的真实涨跌情况进行比较，计算决策树方法预测的准确率（预测正确个数／预测期总月份数）


- 采用改进后的CART方法，加入了自动剪枝过程，从而减少过拟合。


- 根据上述决策树预测结果为基础的择时策路（下图中 CART Strategy）：
- 如果模型看涨则在下一个交易日全仓买入，看跌则在下一个交易日清仓（假设初始购入资金为10万，单边买入成本定为05％，与之对应的为基准交易策路时应下图中HS300 Strategy），即开始时全仓购入沪深300指数并持续持有。从下图中可以看出，尽管2008-2017年期间大盘整体表现不佳，但决策树策路仍然保持了为正的累计收益率，井且其收益率比持续持有沪深300指数要高出21.3％

### 非监督学习实例——趋势动量模式选股聚类

- 策路思路：使用聚类的方法，找到短期内表现较好股票的动量和趋势模式特征，选择最接近该特征的段票构建投资组合，使得组合能够在较短周期内取得较好收益
- 策路流程:

1．在T时刻，计算所有股票在T－20时刻的动量和趋势指标值，根据股票的指标值和市值（已去极值标准化处理）对所有股票进行K－ means聚类，得到M个股票组（类别）

2．每个股票组构成一个投资组合，假设对组台内每只股票等权重分配资金，计算每个投资组台从T－20持有至日的组合收益值

3．对M个组合的收益值进行排序，找到收益值最高的股票组合，并得到这个类别的指标中心向量，记为 center

4．在T时刻下计算所有股票的指标向量，计算每个向量与最优中心 center的欧氏距离，按照距离由小到大排序，得到前20只股票，作为当前选出的票组台进行投资，持有20天后卖出

- 对2007年1月1日至2017年7月14日全A股市场所有股票的日线数据进行分析，基准分别选取上证综合指数和沪深300指数


- 构建投资组合时，剔除停牌以及上市未满1年的股票，策路表现如右图所示

策路所采用的动量和趋势指标计算方法如下：

ROC(Rate of Change) = (Price Today - Price n Days Ago)/Price n Days Ago * 100

Trend Indicator = (Price - EMA)/EMA * 100

其中EMA为股价的指数移动均值。分别选収125天R0C、20天ROC和200天 Trend Indicator、50天Trend Indicator为长、短周期动量和趋势指标。

### 深度学习实例基于深度学习的Apha策路

- 什么是多因子Apha策略：

  现代金融理论认为，证券投资者所获的的收益分为两部分：来自市场的平均收益（即Beta收益）。相比传统的投资策略。阿尔法策略具有更强的主动性，投资者不再被动等待交易时机，而是通过主动选取具备Alpha正收益的股票，随时进场交易。由于Alpha策略是一种中性策略，因此投资者在弱势和振荡行情中也能获得稳定收益，不需要判断大盘走势。多因子Alpha策略通过发掘出驱动个股产生Alpha收益的因子，根据有效的Alpha因子设计相应的选股策略。筛选投资的股票组合，以寻找超越市场的股票超额收益。

**(就是俗称的多因子选股模型)**



- 策略思路：多因子策路在选取因子时，要使得所选因子在一定的操作同期内具有较大的Alpha，即超额超益，如果某因子与股票未来一段时间内的投资收益直接相关，财该因子可以作为Apha策路的备选因子，基于深度学习的交易策路是借助于深度学习对大量的历史交易数据进行学习，建立预测模型，从而获取Alpha因子，即深度学习模型的预测得分。



- 深度学习模型建立起当前时刻（t时刻）及此前时刻市场数Xt以及一段时间后股票价格的变化Yt之间的关系，即使用t时刻信息Xt通过深度学习模型对此后的Yt进行预测，其预测得分可以作为Alpha策略的因子。


------



- 策略模型：一般而言，预测时间间隔越短，机器学习模型的预测能力会越强，但短时间内股票高频数据涨跌幅度较小，考虑到交易成本，交易周期过短的预测模型很难实现盈利。故此策略以周为换仓周期，预测模型也以周为预测周期，多因子策略选择的股票池为中证800成分股，以2006年1月以来的股票行情数据，采取滚动预测的方式来建立深度学习模型，用来预测此后的股票涨跌幅。



- 在Alpha策路中，我们寄望于找到与股票大幅度变化相关的因子。仅有少数周，股票价格的波动会很大。以2006年至2011年行情作为样本为例，样本内102万多个样本中，有22万多个样本的5个交易日后股价变化绝对值大于等于8%，所占比例约20%。因此，预测模型在训练时，选取了三类样本：5个交易日后涨幅大于8%的样本（大涨样本）；5个交易日后跌幅大于8%的样本（大跌样本）；5个交易日后涨跌幅小于1%的样本（平盘样本）。通过深度学习模型，可以对样本是否大涨和大跌给出预测得分。



深度学习实例基于深度学习的Apha策略

- 对冲策略效果：依次考虑不同组合规模，即组合内股票数量为10只、30只、50只、100只、200只、300只时对冲策路的实证结果，为了说明该动预测模型的效果，比较了滚动预测模型和固定模型下的收益情况，收益曲线如下图所，年度收益率如下表所示

------



- 模型预测效果：深度学习网络的第一个隐层有400个节点，第二个隐层有200个节点，输出层有2个节点（输出 ScoreUp和  ScoreDown依次表示预测价格是上涨或者下跌的得分）。无监督学习的隐层训练送代次数为50次，有监督学习的迭代次数为400次。样本外预测结果如下表所示：





**该样本5个交易日后股价变化均值**

|**预测得分**|** 前5%**|** 前10%**|** 前15%**|** 前20%**|
| ------ |----- |----- |----- |----- |
| ScoreUp  | 1.97% | 1.39% | 1.11% | 0.92% |
| ScoreDown | -0.66% | -0.45% | -0.33% | -0.26% |
| ScoreUp-ScoreDown | 1.97% | 1.48%|1.24% | 1.09% |
| ScoreDown-ScoreUp | -0.64% | -0.59%| -0.56%| -0.50%|

- 因为单向做多策略风险一般较大，多空配对策路需要融券做空，实际操作存在困难，因此选取资金等权对冲策路进行模拟，交易手续费为单边3％

------



- 根据前面的预测模型，我们获得了个股在T＝5个交易日之后大福上系预的得分ScoreUp和大幅下跌预测的得分ScoreDown，由此，我们可以很方便的建立起类似多因子选股模型的交易策略．以组合规模为100为例，选取当日上得分ScoreUp最大的前100只股票作为看多组合，当日下跌测得分ScoreDown最大的前100只股票作为看空组合



- 由此至少可以行生出以下三种策路：

（1）单向做多策略。每个交易日买入前100只股票的看多组合，组合中间的个股按照资金等权的方式进行配置，

（2）多空配对策略。毎个交易日买入前100只股票的看多组合，通过融券卖出前10％的看空组合。看多组合和看空组合总共的资金量相等，组合内部按照资金等权的方式进行个股配置，

（3）资金等权对冲策路．毎个交易日买入前100只股票的看多组合，同时做空沪深300指期货进行对冲。看多组合内按照资金等权的方式进行个股配置

------



- 在预测模型输入的选择上，选择的是短期内的股票价格，以及价格的变化范田，买卖盘价格和委卖委买量等。



- 选取输入变量：收盘价、最高价、最低价、开盘价、买卖盘报价平均值、成交量、委买委卖量之比（log(委买量/委卖量)）、此前50个交易日收盘价



- 由于A股市场有涨跌停限制，为了能够使得Apha策略能够应用于实际交易中并且有足够大的市场容量，在训练预测模型和实证分析选取股票组合时都预先剔除了当天收盘价格相对于上一个交易日收盘价格涨幅的超过9％或者跌幅超过9％的股票。



- 为了消除不同股票的差异性以及股票处于不同价格时的差异性，数据的预处理过程包括股价数据的标准化（将交易日t的输入向量中所有股价数据除以交易日t的收盘价格并取对数），极端数据的平滑（用变量的99．9％和0．1％为门限，超过门限的数据用门限值来替代），和归一化（所有数据转化为[0,1]之间的数据）

------



- 从行业分布来看，左图给出了动预测模型组合规模为100时每期组台所选行业段票数量的变化情况。从中也可以看到该策略组合的股票换手率比校高，每一期所选择的行业与其上一期的组合也有很大的变化。右图展示了每期组合各行业股票数量中位数，医药、房地产、电器元器件等行业的股票是该策略比较青睐的股票。

- 一月成交金额和股价动量是主流多因子模型中性能比较好的两个量价因子，基于成交金额-股价动量双因子的对冲组合与深度学习预测模型对冲组合的比较如左图所示，两个组合都是组合规模为100的等权组合，按周换仓。可以看到，深度学习对冲组合的收益情况优于成交金额股价动量双因子对冲组合，按月的收益比较如右图所示，在绝大多数月份，深度学习对冲组合的收益都好于成交金额－股价动量双因子组台
