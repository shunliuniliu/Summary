## 题目1

假设有一个硬币，抛出字（背面）和花（正面）的概率都是0.5，而且每次抛硬币与前次结果无关。现在做一个游戏，连续地抛这个硬币，直到连续出现两次字为止，问平均要抛多少次才能结束游戏？注意，一旦连续抛出两个“字”向上游戏就结束了，不用继续抛。
上面这个题目我第一次见到是在pongba的TopLanguage的一次讨论上，提出问题的人为Shuo Chen，当时我给出了一个解法，自认为已经相当简单了，先来考虑一下抛硬币的过程：首先先抛一枚硬币，如果是花，那么需要重头开始；如果是字，那么再抛一枚硬币，新抛的这枚如果也是字，则游戏结束，如果是花，那么又需要重头开始。根据这个过程，设抛硬币的期望次数为T，可以得到关系：
　　T = 1 + 0.5T + 0.5( 1 + 0.5 * 0 + 0.5T) 
解方程可得到 T = 6。

或者根据公式，需要连续抛出n个字的一般情形，结果相当简洁：**Tn = 2^(n+1) - 2**，其中Tn为首次出现连续的n个字的期望投掷数。

公式证明如下：

**方法一：**

**简洁明了证明：连续出现n次正面（或反面）**

#### 英文原题：Assume that you have a fair coin. What is the expected number of coin tosses to get n heads in a row ？

设出现连续k次正面的期望是a[k]
则出现连续k+1次正面的期望为a[k+1]
在出现连续k次正面后，有下面几种情况：
i)下一个是正面，概率1/2，总次数a[k]+1;
ii)下一个是反面，概率1/2，则接下来平均仍需a[k+1],总次数a[k]+1+a[k+1]。
因此a[k+1]=(a[k]+1)/2+(a[k]+1+a[k+1])/2
整理得(a[k+1]+2)/(a[k]+2)=2
a[n]=(a[1]+2)*2^(n-1)-2
显然a[1]=2;a[n]=2^(n+1)-2



**方法二：**

转自matrix67  http://www.matrix67.com/blog/archives/3638

设想有这么一家赌场，赌场里只有一个游戏：猜正反。游戏规则很简单，玩家下注 x 元钱，赌正面或者反面；然后庄家抛出硬币，如果玩家猜错了他就会输掉这 x 元，如果玩家猜对了他将得到 2x 元的回报（也就是净赚 x 元）。
让我们假设每一回合开始之前，都会有一个新的玩家加入游戏，与仍然在场的玩家们一同赌博。每个玩家最初都只有 1 元钱，并且他们的策略也都是相同的：每回都把当前身上的所有钱都押在正面上。运气好的话，从加入游戏开始，庄家抛掷出来的硬币一直是正面，这个玩家就会一直赢钱；如果连续 n 次硬币都是正面朝上，他将会赢得 2^n 元钱。这个 2^n 就是赌场老板的心理承受极限——一旦有人赢到了 2^n 元钱，赌场老板便会下令停止游戏，关闭赌场。让我们来看看，在这场游戏中存在哪些有趣的结论。

首先，连续 n 次正面朝上的概率虽然很小，但确实是有可能发生的，因此总有一个时候赌场将被关闭。赌场关闭之时，唯一赚到钱的人就是赌场关闭前最后进来的那 n 个人。每个人都只花费了 1 元钱，但他们却赢得了不同数量的钱。其中，最后进来的人赢回了 2 元，倒数第二进来的人赢回了 4 元，倒数第 n 进来的人则赢得了 2^n 元（他就是赌场关闭的原因），他们一共赚取了 2 + 4 + 8 + … + 2^n = 2^(n+1) - 2 元。其余所有人初始时的 1 元钱都打了水漂，因为没有人挺过了倒数第 n + 1 轮游戏。
另外，由于这个游戏是一个完全公平的游戏，因此赌场的盈亏应该是平衡的。换句话说，有多少钱流出了赌场，就该有多少的钱流进赌场。既然赌场的钱最终被赢走了 2^(n+1) - 2 元，因此赌场的期望收入也就是 2^(n+1) - 2 元。而赌场收入的唯一来源是每人 1 元的初始赌金，这就表明游戏者的期望数量是 2^(n+1) - 2 个。换句话说，游戏平均进行了 2^(n+1) - 2 次。再换句话说，平均抛掷 2^(n+1) - 2 次硬币才会出现 n 连正的情况



## 题目2

一景区需要门票5元，售票员没有零钱，假设这一天会来2N个人，其中N个人会给5元钱，N个人给10元，问所有人都不需要等待的概率是多少？

https://www.nowcoder.com/questionTerminal/1c1b35a1404345c899ab44cfa1077766

 1、不考虑人物排列满足卡特兰数 h(N)=h(0)*h(N-1)+h(1)*h(N-2)+...+h(N-1)h(0)=(2N)!  / (N+1)!N! 

  2、加入人物排列得到不需要找零钱的排列方法总数为和 h(N)*N!*N! 

  3、2N个人总排列方法总数为（2N）! 

  4、概率为和h(N) / (2N)!=1 / (N+1)



很多变种题目

https://baike.baidu.com/item/catalan



## 题目3

https://blog.csdn.net/yinjunshishui/article/details/14647805

问题描述：要求从N个元素中随机的抽取k个元素，其中N无法确定。

这种应用的场景一般是数据流的情况下，由于数据只能被读取一次，而且数据量很大，并不能全部保存，因此数据量N是无法在抽样开始时确定的；但又要保持随机性，于是有了这个问题。

这里的核心问题就是“随机”，怎么才能是随机的抽取元素呢？我们设想，买彩票的时候，由于所有彩票的中奖概率都是一样的，所以我们才是“随机的”买彩票。那么要使抽取数据也随机，必须使每一个数据被抽样出来的概率都一样。

 

问题解答：

在考虑问题过程中，可以具体化，在100个数据中可以等概率抽取了10个数据，当又来了20个数据时，怎样能等概率的抽取10个数据，所以在面临每个数据时，可能存在一次等概率的选取；另一种思考方向是当k=1时，简化为怎样随机的选取一个元素，如下面这个实际问题。

问题起源于编程珠玑Column 12中的题目10，其描述如下：

How could you select one of n objects at random, where you see the objects sequentially but you do not know the value of n beforehand? For concreteness, how would you read a text file, and select and print one random line, when you don’t know the number of lines in advance?

问题定义可以简化如下：在不知道文件总行数的情况下，如何从文件中随机的抽取一行？

给出解决方案：在扫描第i个行时，以1/i的概率选择该行，选择意味着选取当前行并替换前面已经选到的那行。即，扫描到第一行时，选择；扫描到第二个行时，以1/2的概率替换第一个行；扫描到第三个行时，以1/3的概率替换前面选取的行，以此类推，直至扫描完一遍后，选取到的行号恰好是等概率的。

证明：设行号为[1…N]，即证明选取每行的概率为1/N。设1<= i <=N，选取到第i行的事件为第i次选取了第i行且后面每次选择过程中均没有选中。概率为



证毕。也可以用数学归纳法证明。

 

所以当随机选取k行时，就是最开始的问题。从上面的解决方案中得到启发，给出下面的选取策略：先选取前面的k行，从第k+1行开始，以k/i的概率选取一行并替换前面选到的k行中的一行，其中i为当前行号，i >= k+1。这样的选取过程也可以做到随机等概率。

证明：设行号为[1…N]，即证明选取每行的概率为k/N。当i > k时，选取第i行的概率为k/i。计算最终扫描完后选取到第i行的概率，即第i行在最终选取的k行中的概率。这一事件发生是第i次扫描时选中该行，并且以后每次扫描一行时，那一行或者没有选中或者选中但替换的不是第i行，直至第N行。概率





        当1<= i <=k时，即，是取上面的i=k得p=k/n。

综上，可得随机选取k行是等概率。证毕。

 

上述问题，存在不同的变种，结合实际的背景出现不同的形式。但均可以抽象为蓄水池抽样问题，又叫随机抽样问题。下面给出一些其他的形式：

1、在一个长度N未知的链表中随机选取k个元素，要求仅扫描链表一次且选取k个元素是等概率的。

2、从实时的搜素词中随机抽出k个词。

