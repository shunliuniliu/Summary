# [ETF交易型开放式指数基金](https://baike.baidu.com/item/%E4%BA%A4%E6%98%93%E5%9E%8B%E5%BC%80%E6%94%BE%E5%BC%8F%E6%8C%87%E6%95%B0%E5%9F%BA%E9%87%91)

交易型开放式指数基金属于开放式基金的一种特殊类型，它结合了[封闭式基金](https://baike.baidu.com/item/%E5%B0%81%E9%97%AD%E5%BC%8F%E5%9F%BA%E9%87%91/260502)和[开放式基金](https://baike.baidu.com/item/%E5%BC%80%E6%94%BE%E5%BC%8F%E5%9F%BA%E9%87%91/260408)的运作特点，投资者既可以向基金管理公司申购或赎回基金份额，同时，又可以像封闭式基金一样在二级市场上按市场价格买卖ETF份额，不过，[申购](https://baike.baidu.com/item/%E7%94%B3%E8%B4%AD/2056752)赎回必须以一篮子股票换取基金份额或者以基金份额换回一篮子股票。由于同时存在证券市场交易和申购[赎回](https://baike.baidu.com/item/%E8%B5%8E%E5%9B%9E/2056850)机制，投资者可以在ETF市场价格与基金单位净值之间存在差价时进行[套利](https://baike.baidu.com/item/%E5%A5%97%E5%88%A9)交易。套利机制的存在，使得ETF避免了封闭式基金普遍存在的折价问题。

根据投资方法的不同：ETF可以分为[指数基金](https://baike.baidu.com/item/%E6%8C%87%E6%95%B0%E5%9F%BA%E9%87%91/3519793)和积极管理型基金，国外绝大多数ETF是[指数](https://baike.baidu.com/item/%E6%8C%87%E6%95%B0)基金。目前国内推出的ETF也是指数基金。ETF指数基金代表一篮子股票的所有权，是指像股票一样在证券交易所交易的指数基金，其交易价格、基金份额净值走势与所跟踪的指数基本一致。因此，投资者买卖一只ETF，就等同于买卖了它所跟踪的指数，可取得与该指数基本一致的收益。通常采用完全被动式的管理方法，以拟合某一指数为目标，兼具股票和指数基金的特色

- 股票ETF
- 债券ETF
- 商品ETF
- 货币ETF

## 套利机制

由于ETF在二级市场交易，受供需关系的影响，会造成ETF市场交易价格与其净值之间产生偏差。此外，ETF收取管理费、付出交易成本以及分派股息红利，也会造成两者间一定的偏差。当这种偏差较大时，投资者就可以利用申购赎回机制进行套利交易。

比如，当上证50ETF的市场交易价格高于[基金份额净值](https://baike.baidu.com/item/%E5%9F%BA%E9%87%91%E4%BB%BD%E9%A2%9D%E5%87%80%E5%80%BC)时，投资者可以买入组合证券，用此组合证券申购ETF基金份额，再将基金份额在二级市场卖出，从而赚取扣除交易成本后的差额。相反，当ETF市场价格低于净值时，投资者可以买入ETF，然后通过一级市场赎回，换取一篮子股票，再在A股市场将股票抛掉，赚取其中的差价。

套利机制给投资者提供了一种新的盈利机会，但其最大的作用其实在于，通过套利者的申购赎回交易，消除ETF交易价格与其净值之间的偏差，使ETF交易价始终与指数保持一致。

必须强调的是，由于套利交易需要操作技巧和强大的技术工具，且一两个机构的一次套利交易就消除了套利的机会，因此，对散户而言，套利交易并不合适。上证50ETF上市后的申购赎回的起点是100万份，也决定了中小散户无法参与套利。

从套利机会出现的原因可以把ETF套利分成多类：一二级市场间套利，期货现货市场间套利，不同盯住指数间套利等。

**一二级市场间套利**　　传统ETF交易机制有两层：首先，在交易时间内，投资人在一级市场可以随时以组合证券的方式申购赎回ETF份额；其次，在二级市场上，ETF在交易所挂牌交易，投资人可按市场价格买卖ETF份额。

​        当ETF的二级市场价格高于其基金份额参考净值(IOPV)一定幅度时，投资者可用相对较低的价格申购ETF份额，以较高的价格在二级市场卖出获得套利收益；当ETF二级市场价格低于IOPV一定幅度时，投资人可以反向操作。该种套利模式需要投资者有一定的资金基础，过少资金无法操作。

**期货现货市场间套利**
　　期货现货市场间套利是利用指数期货和ETF(代表一篮子股票现货)之间偏差赚取利润。如以沪深300指数期货为交易标的的套利。市场中有一些投资者，会利用期货现货市场与沪深300指数高度同步、偶有偏差的ETF来套利。

**不同盯住指数间套利**

　　如果投资者判断虽然市场的整体方向向上，但是盯住A行业的ETF前景比盯住B行业的更好，投资者就可以通过卖出盯住B行业ETF，同时买入盯住A行业ETF，从而获得两支ETF之间的差价。

　　另外一种是ETF和盯住指数之间的套利。

　　有些基金公司采用代表性复制法组建ETF，通过优选部分成分股复制指数来降低交易成本。选择使用代表性复制法的ETF没有完全复制盯住指数中的成分证券，因此在ETF和盯住的指数之间不时存在变动方向和变动幅度的不同步。

# 优矿上的策略示例

# [沪深300etf策略](https://uqer.io/v3/community/share/58fcab6d4a34b00058f07d09)

权重的选取参照了百度百科：hs300指数以调整股本为权重，例如，某股票流通股比例（流通股本/总股本）为7%，低于10%，则采用流通股本为权数；某股票流通比例为35%，落在区间（30，40]内，对应的加权比例为40%，则将总股本的40%作为权数。

```python
import numpy as np
import pandas as pd
import datetime as dt
import math

from pandas import Series, DataFrame, isnull  
from datetime import timedelta, datetime
from CAL.PyCAL import *  #优矿的分析库

pd.set_option('display.width',
              200) 

start = '2007-01-10'  # 回测起始时间

end = '2017-04-20'
benchmark = 'HS300'  # 策略参考标准
universe = DynamicUniverse('HS300')  #股票池为‘沪深300’

capital_base = 100000000  # 起始资金
freq = 'd'  # 策略类型，'d'表示日间策略使用日线回测，'m'表示日内策略使用分钟线回测
refresh_rate = 125  # 调仓频率，表示执行handle_data的时间间隔，若freq = 'd'时间间隔的单位为交易日，若freq = 'm'时间间隔为分钟
cal = Calendar('China.SSE')  
#___________________________________________________________________________________

#设置手续费
commission = Commission(buycost=0.0003, sellcost=0.0013)

#__________________________________________________________________________________


def initialize(account):  # 初始化虚拟账户状态
    pass


#选取沪深300，并按流通市值进行加权


def marketvalue_weight(current):  

    marketvalue = DataFrame() 

    #获得流通市值
    marketvalue = DataAPI.MktEqudGet(
        tradeDate=current,
        secID=universe.preview(current),
        field=['secID', 'negMarketValue','marketValue'],
        pandas="1")
    marketvalue = marketvalue.dropna()
    
    #计算权重
    market_ratio = marketvalue.xs('negMarketValue',axis=1)/marketvalue.xs('marketValue',axis=1)
    market_ratio1=[]
    for ratio in market_ratio:
        if ratio<=0.1:
            market_ratio1.append(ratio)
        else:
            ratio=(int(ratio*10)+1)/10.0      #调整股本
            market_ratio1.append(ratio)
    
    marketvalue.ix[:, ['negMarketValue']]= market_ratio1*marketvalue.xs('marketValue',axis=1)
    market_sum = marketvalue.ix[:, ['negMarketValue']].sum()  
                                                                        
    marketvalue.ix[:, ['negMarketValue']] = marketvalue.ix[:, [
        'negMarketValue'
    ]] / market_sum  
    marketvalue.set_index('secID', inplace=True) 

    return marketvalue


def handle_data(account):  # 每个交易日的买入卖出指令

    current = account.current_date  
        
    prices = account.reference_price 
    weight = marketvalue_weight(current)
    stock_pool = list(set(universe.preview(current)) & set(account.universe))
    #stock_pool=account.universe
    for stk in account.security_position: 
        if stk not in universe.preview(
                current):  
            order_to(stk, 0)  #对于不在沪深300内的卖出
        else:
            continue

    for stk in stock_pool:  #买单的证券值，之前已经定义

        if np.isnan(prices[stk]) or prices[stk] == 0:  # 停牌或是还没有上市等原因不能交易
            continue

        else:
            order_pct_to(stk, 1.0 *
                         weight.ix[stk, 'negMarketValue'])  #按流通市值权重购买
    return

```

- 年化收益率5.5%
- 基准年化收益率4.6%
- 阿尔法1.0%
- 贝塔0.95
- 夏普比率0.09
- 收益波动率28.7%
- 信息比率0.12
- 最大回撤71.1%
- 年化换手率197.97%



# [中证500etf策略](https://uqer.io/v3/community/share/58fd88e04a34b00057f07bda)

权重的选取与**沪深300**相同，参照了百度百科[沪深300指数](http://baike.baidu.com/link?url=q3hoJe-_3AErhG3jp9ofwc9zVghmojdWfoql6wkIjL223JQu8CQ7woSA-HbsO4TsxMCz6l_Bxs2rix7HfIAylSr8xhmfeblY5paSKaZqiHtIxW_llxJEqAzUg_BO451jVERHswAztJKOJJWl5wC8ymJ56qrVpeMuSW7rBP7f74iQyG7hqcZpNaJlCLU6S3ii)，以**调整股本**为权重，如下表所示：

| 流通比例 | <=10     | <=20 | <=30 | <=40 | <=50 | <=60 | <=70 | <=80 | >80  |
| -------- | -------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 加权比例 | 流通市值 | 20   | 30   | 40   | 50   | 60   | 70   | 80   | 100  |

比起[沪深300etf](https://uqer.io/community/share/58fcab6d4a34b00058f07d09)来说，中证500etf跟踪指数的效果可以说相当好。

```python
import numpy as np
import pandas as pd
import datetime as dt
import math

from pandas import Series, DataFrame, isnull  
from datetime import timedelta, datetime
from CAL.PyCAL import *  #优矿的分析库

pd.set_option('display.width',
              200) 

start = '2007-07-20'  # 回测起始时间

end = '2017-04-20'
benchmark = 'ZZ500'  # 策略参考标准
universe = DynamicUniverse('ZZ500')  #股票池为‘中证500’

capital_base = 100000000  # 起始资金
freq = 'd'  # 策略类型，'d'表示日间策略使用日线回测，'m'表示日内策略使用分钟线回测
refresh_rate = 125  # 调仓频率，表示执行handle_data的时间间隔，若freq = 'd'时间间隔的单位为交易日，若freq = 'm'时间间隔为分钟
cal = Calendar('China.SSE')  
#___________________________________________________________________________________

#设置手续费
commission = Commission(buycost=0.0003, sellcost=0.0013)

#__________________________________________________________________________________


def initialize(account):  # 初始化虚拟账户状态
    pass


#选取中证500，并按流通市值进行加权


def marketvalue_weight(current):  
    current=cal.advanceDate(current,Period('-1B')).strftime("%Y-%m-%d") # 获取执行日前一个工作日的日期
    marketvalue = DataFrame() 

    #获得流通市值
    marketvalue = DataAPI.MktEqudGet(
        tradeDate=current,
        secID=universe.preview(current),
        field=['secID', 'negMarketValue','marketValue'],
        pandas="1")
    marketvalue = marketvalue.dropna()
    
    #计算权重
    market_ratio = marketvalue.xs('negMarketValue',axis=1)/marketvalue.xs('marketValue',axis=1)
    market_ratio1=[]
    for ratio in market_ratio:
        if ratio<=0.1:
            market_ratio1.append(ratio)
        elif ratio>0.8:
            ratio=1.0
            market_ratio1.append(ratio)
        else:
            ratio=(int(ratio*10)+1)/10.0      #调整股本
            market_ratio1.append(ratio)
    
    marketvalue.ix[:, ['negMarketValue']]= market_ratio1*marketvalue.xs('marketValue',axis=1)
    market_sum = marketvalue.ix[:, ['negMarketValue']].sum()  
                                                                        
    marketvalue.ix[:, ['negMarketValue']] = marketvalue.ix[:, [
        'negMarketValue'
    ]] / market_sum  
    marketvalue.set_index('secID', inplace=True) 

    return marketvalue


def handle_data(account):  # 每个交易日的买入卖出指令

    current = account.current_date  
        
    prices = account.reference_price 
    weight = marketvalue_weight(current)
    stock_pool = list(set(universe.preview(current)) & set(account.universe))
    #stock_pool=account.universe
    for stk in account.security_position: 
        if stk not in universe.preview(
                current):  
            order_to(stk, 0)  #对于不在沪深300内的卖出
        else:
            continue

    for stk in stock_pool:  #买单的证券值，之前已经定义

        if np.isnan(prices[stk]) or prices[stk] == 0:  # 停牌或是还没有上市等原因不能交易
            continue

        else:
            order_pct_to(stk, 1.0 *
                         weight.ix[stk, 'negMarketValue'])  #按流通市值权重购买
    return

```

- 年化收益率6.1%
- 基准年化收益率6.0%
- 阿尔法0.1%
- 贝塔0.99
- 夏普比率0.05
- 收益波动率32.9%
- 信息比率0.02
- 最大回撤72.2%
- 年化换手率253.10%







