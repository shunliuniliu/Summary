# CTA策略详解

## 概念介绍

CTA策略更多的时候是一种投资方法，更准确的说，主要投资于衍生品的、比较系统化规则化的投资方法都可以称作CTA投资，它并不拘泥于量化或是主动，其具有相当的生命力，会长期存在。

CTA策略的收入来源是多样化的，目前市场上最熟悉的是利用动量策略赚取价差，往往以量化趋势跟踪作为了CTA策略的代名词；实际上，CTA策略本身存在相当多的收益来源，通过各种方法都可以为组合创造实实在在的收益。

研究表明，作为一种投资策略方法，CTA策略可投资标的远远超过商品期货，即使在商品市场长期处于横盘震荡状态仍然可以通过品类繁多的投资标的争取长期稳健回报。

**什么是CTA策略？**

CTA 全称是 Commodity Trading  Advisors，即“商品交易顾问”，也称作管理期货。它是指由专业的资金管理人运用客户委托的资金投资于期货市场和期权市场，并且收取相应管理费用的一种基金组织形式。**CTA作为一种投资的策略方法，本质上是规则的集合**，它的规则性很强，许多投资门类都包含在内，是实现资产配置中分散投资的一种重要方式，目前正逐步成为成熟投资机构的基础资产配置之一。

从Managed Futures Barclay CTA Index来看，CTA策略的历史已有40年之久，**它的投资标的不仅仅限于商品期货，而是扩展到包括利率期货、股指期货、外汇期货在内的所有期货品种上**。

从**国际**成交数量来看，**CTA策略中商品期货投资只占了1/4-1/3**，以动量型策略为主，而**金融衍生品已经占到整个CTA策略成交量的一半以上**，这与国际市场上投资种类丰富、衍生品的发育成熟有关；反观**国内**，投资者经**常把CTA策略和商品投资划等号，这主要是因为国内的股指期货投资受限，国债期货市场还在逐步发育过程中**。

专家预计再过3年左右时间，随着国内期货市场的不断发展，股指期货、国债期货、商品期货的新品种的陆续推出，期权市场的逐步推进，CTA 在国内可以投资的标的将不断增多，潜在的获利机会也会相应增加，国内投资情况会和国外会更加接近。

**量化CTA逐渐成为主流**

就投资方法而言，CTA基金有两大类，一类是主观CTA，即由基金管理人基于基本面、调研或操盘经验，主观来判断走势，决定买卖时点；第二大类是量化CTA，是通过分析建立数量化的交易策略模型，由模型产生的买卖信号进行投资决策。

相比较而言，用量化的方法来投资期货能够在获取收益的同时很好的管理风险。量化CTA能够很好的避免人为主观的非理性，在出现亏损或回撤时能够及时的止损从而有效的规避风险，同时量化CTA基金能够产生规模效应，这也是在国内乃至海外，量化逐渐成为CTA基金的主流交易方法。

Preqin Hedge的数据统计，在海外，2014年80%的CTA基金采用程序化交易，9%采用混合策略，仅11%的基金采用主观分析。而在国内，根据期货资管网的统计，国内量化CTA占比约5成并呈稳步上扬的势头。

![img](https://upload-images.jianshu.io/upload_images/14240212-a2e188970335a0ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![img](https://upload-images.jianshu.io/upload_images/14240212-a2e188970335a0ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**量化CTA基金特征**

**一、低相关性**

CTA基金与股票、债券、大宗商品的、其他类对冲基金都表现出低相关性。在传统大类资产组合配置的基础上，配置一定比例的CTA基金，能使整体资产组合实现增强收益、降低风险的双重效果。并且，CTA基金具有双向获利功能，即便股市展开阶段性调整，CTA基金仍具备较强的获利能力。

**二、中高收益**

Eurekahedge的CTA指数在2000/01-2015/07期间15年累计收益率365%，年化收益10.37%，最大回撤6.34%，年化标准差6.90%。与海外成熟市场相比，国内CTA基金尚处于快速发展阶段。但正是**由于市场不成熟，使得国内CTA基金收益率相较海外更高，历史回撤也更小。**

**三、非线性**

量化CTA基金还有一个显著的特性就是收益非线性。CTA基金的收益方式体现在低胜率、高盈亏比上，即一年的2-3波行情就能将全年的收益实现，其他时间是处于横盘或者回撤的状态。简单来说，量化CTA的收益和投资标的的涨跌无关，和投资标的的涨幅或者跌幅有关，即在波动率很大的行情中容易获利。**用一个形象的比喻，投资标的的波动率是CTA基金获利的心电图，一马平川或者小幅来回震荡贡献不了收益率甚至会出现回撤，而波峰波谷频现大起大落的行情下，CTA就能大幅获利。**

**如何挑选真正优质的量化CTA产品**

市场上CTA基金产品琳琅满目，如何选出真正优质的量化CTA产品呢？建议投资人可以从以下四个方面进行考量：

**1、看业绩**

选择CTA基金，首先看其历史业绩表现和业绩的可持续性，时间越长收益越高，说明产品越好。

**2、看团队**

选择CTA基金，一定要深入研究其团队构成，一个成功可持续的CTA基金，必须依靠团队实力，**好的团队可以进行多策略投资，能够在各种市场形态中均能取得较好的投资收益**，因此团队的专业实力、稳定性等极其重要。

**3、看回撤**

选择CTA基金，还需要关注最大回撤下的收益特征；**最大回撤在一定程度下可以判断该CTA基金的风险敞口大小**，在相同风险敞口下取得的绝对回报的大小，可以更好地评判CTA基金的优秀程度。

**4、看规模**

选择CTA基金，在研究其业绩持续性的同时须关注其整体规模，规模的大小可能对投资经理的投资决策造成影响，管理规模越大的基金，其收益稳定性一般会更稳定。

CTA基金作为一种非主流投资工具，其分散市场风险和防范股票市场系统性风险的能力应该得到传统意义上投资股票和债券市场投资者的重视，尤其是在大环境改变的大背景下，量化CTA基金将会迎来发展的繁荣时期。



## 推荐阅读：掘金量化-示例代码

| **序号** | **标题**                           | **传送链接**                                       |
| -------- | ---------------------------------- | -------------------------------------------------- |
| 1        | 双均线策略(期货)  量化策略源码     | https://www.myquant.cn/docs/python_strategyies/153 |
| 2        | alpha对冲(股票+期货)  量化策略源码 | https://www.myquant.cn/docs/python_strategyies/101 |
| 3        | 跨品种套利(期货)量化策略源码       | https://www.myquant.cn/docs/python_strategyies/106 |
| 4        | 跨期套利(期货) 量化策略源码        | https://www.myquant.cn/docs/python_strategyies/107 |
| 5        | 做市商交易(期货) 量化策略源码      | https://www.myquant.cn/docs/python_strategyies/109 |
| 6        | 谈资金管理                         | https://www.myquant.cn/community/topic/579/2       |
| 7        | 网格交易策略（附策略源码与收益图） | https://www.myquant.cn/community/topic/548/2       |
| 40       | 跨期套利策略                       | https://www.myquant.cn/community/topic/525         |
| 45       | 海龟交易法则                       | https://www.myquant.cn/community/topic/520         |

## 为何受欢迎

CTA策略之所以能得到业界的广泛青睐，源自策略本身的特性，主要包括以下三个方面。

**第一，投资于非传统资产类，达到分散投资的目的**。研究表明，如果将资产过分集中投向股票、债券等传统资产类，很难避免系统性风险带来的损失，而分散式投资不但可以降低风险，而且还能增加收益来源。例如，在2008年全球金融危机时，股票市场暴跌，标普500指数全年下跌37%，以股票类资产为重要配置的投资者必然损失惨重；与此同时，衡量CTA策略表现的Altegris 40指数在2008年却获得了15%的正收益，可谓天壤之别。进一步研究发现，从1990年到2013年，标普500指数同Altegris 40指数的相关性为-0.11，这表明CTA策略是独立于股市的，商品类资产与股票类资产可以形成互补。

**第二，操作上可以多空并举，跨越不同市场创造收益**。以商品期货投资为例，CTA策略在实施中既可能根据对气候变化的研究结果，在厄尔尼诺现象高峰期前买入[大豆](http://futures.hexun.com/soybean/index.html)、[玉米](http://futures.hexun.com/corn/index.html)等农产品期货，也可以基于经济放缓的判断卖出[铜](http://futures.hexun.com/copper/index.html)、[铝](http://futures.hexun.com/aluminum/index.html)等工业材料金属期货，这样的操作无论是多头抑或空头都可能成为收益的独立来源。在实践中，CTA策略基金可以参与全球150多个市场，从期货到期权，从[黄金](http://futures.hexun.com/gold/)、外汇到[原油](http://futures.hexun.com/oil/index.html)，范围之广远超传统投资策略。

**第三，充分使用杠杆，博取更高回报**。“给我一个支点，我将撬动整个地球”，阿基[米德](http://renwu.hexun.com/figure_4197.shtml)的这句名言形象地表达出了杠杆的力量。在CTA策略中，杠杆的使用极为普遍，以策略中最常使用的期货为例，由于期货交易广泛采用[保证金](http://jingzhi.funds.hexun.com/159001.shtml)交易制度，投资者只需要缴纳占投资本金一定比例的保证金，就可以利用较小的资金量来完成大额资金交易，也就是充分利用杠杆来实现以小搏大，提高回报率。当然，杠杆的使用是一把双刃剑，以小搏大也意味着风险的放大，使用不当，投资损失也会随之加大。在操作中，投资者可以根据自己的风险承受能力设定杠杆比例的高低，并随市场的变化进行动态调整，以达到因人而异、随市而动的效果。

------



## 研究对象、周期、方法、分类

**CTA策略研究对象：**

狭义上来说，CTA策略的研究对象只包括期货，像国内的股指期货，大宗商品期货和国债期货（利率期货），这些品种是目前国内CTA策略的主要研究对象和利润来源；

广义上来说，可以是大宗商品期货，国债期货（利率期货），股票，外汇（包括spots和futures），甚至期权等任何有一定历史公开量价数据的品种。

**CTA策略研究周期：**

通常来说，以分钟、小时和日线数据为主。少部分CTA策略也会用到tick数据，包括level2的bid price，ask price，bid volume，ask volume。

**CTA策略研究方法：**

对单个品种历史上的量价数据进行分析，包括开盘价，收盘价，最高价，最低价，成交量，持仓量这些数据，提炼出具有概率优势的规律，这就是通常意义上的因子或者策略，并将此规律用代码实现，并假设这类规律在未来会依然存在。最后用此类规律来判断品种未来的方向，进行开仓，平仓，加仓，减仓等操作，并以此来获利。通常来说，演化至今的CTA策略基本都是全自动交易，但也依然有辅之以手工判断的交易存在。

**CTA策略分类(一家之言，有错请纠正)：**

狭义上来说，传统的CTA策略都是趋势追随策略。白话来说，就是追涨杀跌。文绉绉来说，就是价格的时间序列存在系数为正的自相关关系。这类策略能挣钱的逻辑有这么几种，1是投资者对盈利和亏损比例的容忍程度是不对称的；2是当趋势不断延续时，随着做多和做空双方投资者PNL比例的增加，投资者更容易出现非理性行为，尤其是亏损的一方容易互相践踏平仓；3是价格的returns概率分布本身就是一个很大的肥尾。

趋势追随策略通常胜率会比较低，而每笔交易的盈亏比会比较大，白话来说，就是亏小钱，挣大钱。没行情的时候亏小钱，有行情的时候赚大钱。市场给机会就吃一口，没机会就熬啊熬，熬啊熬。历史上多少CTA基金就是这样被熬死的，倒在了黎明前的黑暗。

广义上来说，CTA策略应该是趋势追踪策略为主，反转策略为辅。就像前面所说的，趋势追踪策略容易死在黎明前，为了避免这点，或者说为了让自己更赖操，就需要一些在没行情的日子里也能喝口汤的策略，这类策略就是反转策略。和趋势追踪相关，反转策略白话来说，就是高抛低吸；文绉绉来说，就是价格的时候序列存在系数为负的自相关关系。很多人会问，价格的时间序列不是非正即负吗，怎么会又正相关，又负相关？这个问题在这儿暂时就不回答了，后续在更新。不过可以肯定告诉大家的就是这个问题的答案值个10万块钱应该没啥问题。趋势策略好写，总体都是类似的。幸福的家庭（趋势策略）都是相似的,每个不幸的家庭（反转策略）都有各自的不幸（反转）。

**CTA策略之前世今生(一家之言，有错请纠正)：**

80年代之前，主要是50s-80s这段时间，在电子交易并未成熟之前，交易员（当时年代的大神），就已经开始书写和传播出一些技术指标来判断大宗商品期货的未来走势，如威廉指标，KDJ，RSI，MACD，CCI等。一些交易员尝到甜头后，开始成立专门的CTA基金来帮忙客户管理资产，这批人就是当年CTA fund的第一批炮灰，或者换个词来说——革命先驱，因为最后的结局都不大好，详情自己google。

而到80年代之后，随着电子盘的普及，真正意义上的CTA基金才开始出现，并涌现出一批够格称得上开山鼻祖的人物，如Martin Lueck和David Harding。经过20多年的的大浪淘沙，下列CTA基金开始杀出重围。很有意思的几个趣闻给大家聊一聊，一是虽然该行业排名每年换血速度极快，城头更换大王旗很常见，但是真正做得好的却总是那几个灵魂人物，在各家公司跳来跳去或者自己另立门户；二是最大的几家CTA都是在英国，个人觉得主要是因为英国的氛围比较懒、经典而传统，比较符合这类型策略的风格；三是牛津和剑桥这两家学校历来都辈出CTA人才，这与当年AHL和Winton争风吃醋不无关系，你去跟牛津合作，俺就去剑桥设点：）

![img](https://pic3.zhimg.com/80/4a437b691578e127cfb4bd400a9a8b2e_hd.jpg)

------



# 国内四种常见日内CTA策略及实现

> 来源：知乎

概要：

1. 介绍常见的CTA策略（Dual Thrust、R-Breaker、菲阿里四价、空中花园策略）
2. 实现各策略并以Dual Thrust为例进行参数优化及止盈止损表现

## **一、常用日内CTA 策略简介**

**1.1 Dual Thrust策略**

Dual Thrust策略是一种趋势跟踪系统，属于日内交易策略。该策略由Michael Chalek 在20世纪80年代开发，曾被Future Thruth杂志评为最赚钱的策略之一。Dual Thrust系统具有简单易用和适用度广的特点，其思路简单且参数少，配合不同的参数、止盈止损和仓位管理可以为投资者带来长期稳定的收益。而且该策略适用品种较多，被投资者广泛应用于股票、货币、贵金属、债券、能源及股指期货市场等。在Dual Thrust交易系统中，对于震荡区间的定义非常关键，这也是该交易系统的核心。**Dual Thrust在Range的设置上，引入前N日的四个价位，Range = Max(HH-LC,HC-LL)来描述震荡区间的大小。**

其中HH 是N日High的最高价，LC是N日Close的最低价，HC是N日Close的最高价，LL是N日Low的最低价。这种方法使得一定时期内的Range相对稳定，可以适用于日间的趋势跟踪。Dual Thrust对于多头和空头的触发条件，考虑了非对称的幅度，做多和做空参考的Range可以选择不同的周期数，也可以通过参数K1和K2来确定。具体分为两步来实现：

第一步：计算相关参数，得到上轨Buyline 和下轨Sellline：

- N日High的最高价HH, N日Close的最低价LC
- N日Close的最高价HC，N日Low的最低价LL
- Range = Max(HH-LC,HC-LL)
- BuyLine = Open + K1*Range
- SellLine = Open - K2*Range

第二步：交易逻辑：

- 当价格向上突破上轨时，如果当时持有空仓，则先平仓，再开多仓；如果没有仓位，则直接开多仓；
- 当价格向下突破下轨时，如果当时持有多仓，则先平仓，再开空仓；如果没有仓位，则直接开空仓；

当K1时，多头相对容易被触发,当K1>K2时，空头相对容易被触发。因此，投资者在使用该策略时，一方面可以参考历史数据测试的最优参数，另一方面，则可以根据自己对后势的判断，或从其他大周期的技术指标入手，阶段性地动态调整K1和K2的值。

**1.2 R-Breaker策略**

R-Breaker 是一种短线日内交易策略，它结合了趋势和反转两种交易方式。该策略也长期被Future Thruth 杂志评为最赚钱的策略之一，尤其在标普500 股指期货上效果最佳。该策略的主要特点如下：

第一、根据前一个交易日的收盘价、最高价和最低价数据通过一定方式计算出六个价位，从大到小依次为突破买入价、观察卖出价、反转卖出价、反转买入价、观察买入价和突破卖出价，以此来形成当前交易日盘中交易的触发条件。通过对计算方式的调整，可以调节六个价格间的距离，进一步改变触发条件。

第二、根据盘中价格走势，实时判断触发条件，具体条件如下：

- 1) 当日内最高价超过观察卖出价后，盘中价格出现回落，且进一步跌破反转卖出价构成的支撑线时，采取反转策略，即在该点位（反手、开仓）做空；
- 2) 当日内最低价低于观察买入价后，盘中价格出现反弹，且进一步超过反转买入价构成的阻力线时，采取反转策略，即在该点位（反手、开仓）做多；
- 3) 在空仓的情况下，如果盘中价格超过突破买入价，则采取趋势策略，即在该点位开仓做多；
- 4) 在空仓的情况下，如果盘中价格跌破突破卖出价，则采取趋势策略，即在该点位开仓做空。

第三、设定止损以及止盈条件；

第四、设定过滤条件；

第五、在每日收盘前，对所持合约进行平仓。

具体来看，这六个价位形成的阻力和支撑位计算过程如下：

- 观察卖出价 = High + 0.35 * (Close – Low)
- 观察买入价 = Low – 0.35 * (High – Close)
- 反转卖出价 = 1.07 / 2 * (High + Low) – 0.07 * Low
- 反转买入价 = 1.07 / 2 * (High + Low) – 0.07 * High
- 突破买入价 = 观察卖出价 + 0.25 * (观察卖出价 – 观察买入价)
- 突破卖出价 = 观察买入价 – 0.25 * (观察卖出价 – 观察买入价)

其中，High、Close、Low 分别为昨日最高价、昨日收盘价和昨日最低价。这六个价位从大到小一次是，突破买入价、观察爱出价、反转卖出价、反转买入价、观察买入价和突破卖出价。

**1.3 菲阿里四价策略**

菲阿里四价策略是一种比较简单的趋势型日内交易策略。昨天高点、昨天低点、昨日收盘价、今天开盘价，可并称为菲阿里四价。它由日本期货冠军菲阿里实盘采用的主要突破交易参照系。菲阿里四价是日内突破策略，所以每日收盘之前都需要进行平仓。该策略的上下轨以及用法如下所示:

- 上轨＝昨日高点；
- 下轨＝昨日低点；

昨日高点和昨日低点可以视为近期的一个波动范围，该范围的存在一定程度是一种压力线，只有足够的价格上涨或者下跌才会突破前期的高点或者低点。因此突破位臵是一个比较好的入场信号，如果突破该波动范围，则证明动能较大，后续走势强度维持较强的概率比较高，因此该策略采用以下开仓方式:

- 当价格突破上轨，买入开仓；
- 当价格跌穿下轨，卖出开仓。

策略在开仓之后可能面临假突破的问题，因为该价位存在很大的阻力，可能是暂时性的突破，随机回落，因此具体策略使用之中可以设臵一些过滤条件来剔除假突破的情况。这样使得策略的胜率变大。开仓之后的止损止盈根据具体环境具体确定。

**1.4 空中花园策略**

空中花园属于日内突破策略。与之前的策略有所不同，空中花园比较看重开盘突破。开盘时的高开或者低开均说明有大的利好或者利空使得开盘大幅远离昨天的收盘价。开盘突破，是最快的一种入场方式。当然出错的概率也最高。因此为了提高策略的胜率，空中花园策略加了额外的条件，也就是开盘要大幅高开或者低开，形成一个空窗，因此顾名思义称为空中花园，然后再根据是否突破上下轨来进行开仓判断。这样一来，策略的胜率将大大提高，不过由于对高开或者低开的幅度要求过高，一般是超过1%，因此使得策略的交易次数可能相对其它策略而言要偏低一些。开盘第一根K线是收阳还是收阴，是判断日内趋势可能运动方向的标准。在当天开盘高开或低开时更有效。空中花园策略主要特点：

日内交易策略，当日收盘平仓； 空中花园在当天高开或低开时使用，即当开盘价>=昨天收盘价*1.01 或开盘价<=昨天收盘价*0.99 时：

- 上轨＝第一根K线的最高价；
- 下轨＝第一根K线的最低价；
- 当价格突破上轨，买入开仓；
- 当价格跌穿下轨，卖出开仓。

## **二、策略回测的数据准备和基本设置**

**2.1 数据准备**

我们可以通过[DataAPI](https://link.zhihu.com/?target=https%3A//uqer.io/data/browse/0/%3Fpage%3D1)获得上期所、大商所、郑商所从2003 年以来所有上市的商品期货的不同月份合约的1 分钟行情数据，包含了open、high、low、close、volume、oi（开盘价、最高价、最低价、收盘价、成交量、持仓量）共6 种价格信息。但对于不同的期货品种来说，受市场关注度高、交易活跃的合约往往只有一个或者两个，因此在进行CTA 回测之前我们便需要对所有品种所有的月份合约都选择出来，筛选出属于不同品种的主力合约来进行CTA 日内交易策略的回测。

一般情况下，主力合约的受关注度、成交量或持仓量较高，受交易品种的生产周期特性、交易者的交易习惯等几个方面所决定。本文回测所使用的主力合约是系统按照持仓量来进行计算的，一般只需在universe中进行设置即可。



![img](https://pic2.zhimg.com/80/v2-2e74b41b1775b80bbd6525bc834b1bcd_hd.png)

2.2 回测框架搭建



本文这里直接均采用优矿期货回测平台，使用方法可以参考[期货策略API文档](https://link.zhihu.com/?target=https%3A//uqer.io/help/futuresApi/)。

## **三、主要CTA策略实证研究**

**3.1 DualThrust策略**

我们在前文当中已经对Dual Thrust 策略进行了简单的介绍。在Dual Thrust 系统中有两个主要参数k1、k2，是昨日波动幅度的倍数，分别决定了上轨线和下轨线与当日开盘价的差距，显然地，如果k1、k2增大时，上下轨线的距离也会变大，直至很难再有触发生成信号的条件。而这种策略实际抓取的是上轨和下轨之外的趋势部分的收益，所以反之如果上轨和下轨之间的距离非常小，就会降低潜在的趋势性收益反而提高了交易次数和交易成本。因为每一次的平仓反转做多或做空实际就意味着该笔交易的收益为负，所以尤其对于震荡型行情来说，就会使得整体的收益表现变差。

**3.1.1 策略未进行优化时的参数选择**

正因为k1和k2的不同大小而使得上下轨线的位置也产生变化，触发产生信号的时间和价格也因此不同，而不同的期货品种所适合的参数也表现不一。为了体现出Dual Thrust 策略的历史表现，我们以全样本数据集进行样本内测试。

年化收益：

![img](https://pic2.zhimg.com/80/v2-a30142a8eac7ea96c7daf8dd38a9b201_hd.png)

最大回撤：

![img](https://pic4.zhimg.com/80/v2-e5f62b8e0ea5ba44de376e39452696c3_hd.png)



夏普：

![img](https://pic1.zhimg.com/80/v2-42a822d34aed8f21590fe0f8dfd75444_hd.png)



热力图：

![img](https://pic4.zhimg.com/80/v2-0566ac2845400d33fa45e46651c800e7_hd.png)



**3.1.2 ATR过滤优化**

前文提到了**如果市场处于平稳的震荡整理行情时或者Dual Thrust的两个参数值都较小的时候，就会容易多次触发产生开平仓的信号**，反而获取不到轨线之外的趋势收益部分，这时Dual Thrust的表现就变得很差。所以，我们就应该在每日回测时先对近期市场行情波动进行一次考察，如果市场波动过小，表明市场近期没有较明显的行情，而是处于震荡整理的态势，那么我们就越过当天不再进行任何操作；如果市场近期波动较大，而实证研究告诉我们金融市场具有波动率簇集的程式化事实特征，即表明大波动行情后面常常也会跟随较大的波动，所以这时我们应选择抓住这样由波动性带来的风险收益。

如何量化近期市场波动呢？ATR（平均真实波动幅度）便是这样一种可以衡量市场波动情况的指标。需要注意的是，**ATR并不能反映行情的趋势程度或者趋势持续状态，而只能对市场行情的波动性有所反映**，不管是上涨区间还是下跌区间。如果我们采用ATR指标来对回测时的交易行为进行过滤的话，那么该指标是否真实有效呢？

这里把ATR的触发条件设为5，当过去20期ATR值超过5时，才能进行下一步的操作。

回测结果如下：

![img](https://pic1.zhimg.com/80/v2-dde1cf318ed15257580eb2f338b5a190_hd.png)

从结果来看没有太多变化

**3.1.3 止盈止损优化**

至此，我们都暂未考虑止盈止损对策略回测结果的影响。尽管在某些参数组合中，最大回撤率被控制得很好，但仍然无法避免在某些时期连续的大幅度回撤。所以，考虑加入止盈止损方法对该策略进一步优化。

在未进行止盈止损优化之前，原始的日内交易策略所采用的其实是持有至收盘（收盘前10-15分钟平仓）的方式，**但这种出市的方式的弊端就是不能锁住潜在的高收益，也使得亏损的机会增加**。而良好的主动出市策略，不仅能锁住利益，而且也能及时有效地减少损失，即真正地做到赢大亏小。与研报不同，我设置的止盈方法是固定比例的止盈，即当当前的价格超过开仓价格一定比例后进行相应的止盈止损。仍以螺纹钢为例，在之前所得的“最优”参数组合的条件下，在进行止盈止损的条件下进行回测，这次我把回测时间延长至2015年6月1日。

**把未止盈止损与ATR+止盈止损优化的策略进行对比分析**

![img](https://pic3.zhimg.com/80/v2-51d59b18aaf262e47ab257149f4cb9b6_hd.png)

未优化:年化收益: 0.2403 ; 最大回撤: 0.0628 ; 夏普比率: 1.8462 

优化后: 年化收益: 0.2317 ; 最大回撤: 0.0402 ; 夏普比率: 1.9403

可以看到，进行ATR+止盈止损优化后，虽然年化收益有轻微的减少，但是却降低了回撤，提高了夏普比率，所以整体来看还是具有一定的有效性。

**3.1.4 部分品种的回测表现**

沪铜

![img](https://pic1.zhimg.com/80/v2-f9290824c6aa97795ecefffa891bb294_hd.png)

未优化:年化收益: 0.5752 ; 最大回撤: 0.0997 ; 夏普比率: 3.0238 

优化后: 年化收益: 0.4971 ; 最大回撤: 0.0766 ; 夏普比率: 2.3992

焦炭

![img](https://pic1.zhimg.com/80/v2-50198016a7e8080d1bf5f8edf8ce4628_hd.png)

未优化:年化收益: 0.0886 ; 最大回撤: 0.1915 ; 夏普比率: 0.2584 

优化后: 年化收益: 0.0888 ; 最大回撤: 0.0914 ; 夏普比率: 0.3639

焦炭今年行情这么好，Dual Thrust居然赚不到钱，也可能是代码不对！但从结果看来这个策略并不是对所有品种都有效啊，难道是螺纹钢的最优参数却不是其他品种最优的参数，有品种差异？

**3.1.5 推进分析**

思想就是用前一期最优的参数来代入当前期的策略中，不断的向前推进，日后有时间在实现。

## **3.2 R-Break策略**

R-Breaker策略与Dual Thrust最大的不同在于它除了趋势交易外，还有反转操作。这种策略根据前一个交易日的最高价、最低价和收盘价通过一定的计算方式得到6个不同的价位，模拟出了价格运动的支撑位、阻力位。R-Breaker策略明确给出了在趋势建立的时候的开仓条件，以及当趋势恶化、行情不利的时候的反转操作的条件。

表现如下：

![img](https://pic3.zhimg.com/80/v2-c40c277eddc09d762963fdd8fd7ca372_hd.png)

在塑料主力上表现很差。

## **3.3 菲阿里四价策略**

菲阿里四价策略本身也是一个趋势突破型的策略，但是策略的突破买入卖出条件更加简单。该策略以昨日行情最高价为今日日内交易的上轨，昨日行情最低价为下轨。如果价格突破上轨，便买入开仓，如果突破下轨，便卖出开仓。显然，这种判断趋势是否存在的条件过于简单，在市场波动剧烈的情况下不是十分有效，回测结果也表明了这点。本文简单的测试了螺纹，糊涂，塑料，橡胶这四个主力期货合约，回测时间从2010年1月1日开始。

表现如下：

![img](https://pic1.zhimg.com/80/v2-6c087a0bbe13e3d3caa3e058f4f91304_hd.png)

沪铜主力在三个策略上表现都还不错。

## **空中花园策略**

空中花园本身就已经包含了一定的过滤条件，它只考虑当天开盘的位置是否大幅度的跳空，即高开或低开昨日收盘的1%，所以该策略十分注重在非交易时间段内消息的累积对今天走势的影响。但是，可能正如研报所说的，往往很多情况下市场对消息的反馈会产生相反的效果，从而使得策略表现不好。

回测结果如下：

![img](https://pic4.zhimg.com/80/v2-072d61bc9a063bfca8887954284f83c3_hd.png)

## **组合测试**

之前曾写过一个单策略多品种的，这次改成多策略多品种的，我也没比较两个序列的相关性而是直接组合，权当提供一种思路。

回测结果如下：

![img](https://pic3.zhimg.com/80/v2-a0de1f43b51de18533550584fcea72d2_hd.png)

原文链接：[国内商品期货常用日内CTA策略测试](https://link.zhihu.com/?target=https%3A//uqer.io/community/share/586f319989e3ba0047efdc09)

参考资料：东方证券《衍生品系列研究之三》：国内商品期货日内常用CTA策略测试