# Django自带服务器出现Connection reset by peer

## 结论

**runserver 是作为开发时候用的，不适合用于生产环节。**

1 静态文件: runserver 服务器当 debug=True 的时候 才会开启静态文件服务器。

2 性能: runserver 应该是单线程的。性能差，如果出现错误挂掉。那么整个进程都挂掉了。

## 分析

### Connection reset by peer的常见原因：

通常是因为远程主机上的对等应用程序突然停止运行，或者远程主机重新启动，或者远程主机使用“强制”关闭（在远程套接字上看到SETSOCKOPT（SOOLIGER））。此外，如果一个或多个操作正在进行，如果连接检测到“保持活跃”活动中的故障，也可能导致此错误。此时，操作返回错误代码WSANETERSET失败，随后的操作将无法返回错误代码WSACONNREST。 

#### 原因分类：

1）服务器的并发连接数超过了其承载量，服务器会将其中一些连接关闭；

如果知道实际连接服务器的并发客户数没有超过服务器的承载量，则有可能是中了病毒或者木马，引起网络流量异常。可以使用netstat -an查看网络连接情况。

2）客户关掉了浏览器，而服务器还在给客户端发送数据；

3）浏览器端按了Stop

这两种情况一般不会影响服务器。但是如果对异常信息没有特别处理，有可能在服务器的日志文件中，重复出现该异常，造成服务器日志文件过大，影响服务器的运行。可以对引起异常的部分，使用try…catch捕获该异常，然后不输出或者只输出一句提示信息，避免使用e.printStackTrace();输出全部异常信息。

4）防火墙的问题

如果网络连接通过防火墙，而防火墙一般都会有超时的机制，在网络连接长时间不传输数据时，会关闭这个TCP的会话，关闭后在读写，就会导致异常。 如果关闭防火墙，解决了问题，需要重新配置防火墙，或者自己编写程序实现TCP的长连接。实现TCP的长连接，需要自己定义心跳协议，每隔一段时间，发送一次心跳协议，双方维持连接。

5）JSP的buffer问题。

JSP页面缺省缓存为8k，当JSP页面数据比较大的时候，有可能JSP没有完全传递给浏览器。这时可以适当调整buffer的大小。

## 解决方法： 

不要使用django自带的服务器 

用Nginx或者Apache