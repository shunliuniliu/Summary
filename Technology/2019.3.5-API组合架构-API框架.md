# API组合架构

> 来源：RESTFul API开发实战 P65

一个组织一般都有多个API，故API组合要求其中的所有API都彼此一致，可重用，可发现，可定制。

### 需求

API消费者和API生产者都有各自的优势与考虑，双方就一致性、可重用、可定制、可发现和持久性制定了API组合的需求。



### 一致性

一个API解决方案，比如移动应用，可使用来自组合的多个API，其中的一个API的输出可能是另一个API的输入。因此，对数据结构、表现形式、URI、错误消息以及API的行为都需要一致性。如果API的行为类似于上一个API并提供类似的错误消息，那么API消费者会觉得API更容易使用。



### 可重用

多种方式：

- 在多个应用之间重用API
- 在多个API中重用API
- 直接重用API的部分代码

API应该被多个消费者、解决方案、项目使用。



### 可定制

虽然看似与可重用矛盾，但二者是可以同时实现。毕竟API的消费者可能不是同一类型，可能对API有特定需求。

#### 实施方法:

一般来说，API消费者对数据格式化和数据交付方式比较感兴趣，并不关心数据采集，因此这些可以分为两部分：

1. 一个API**负责数据采集**，成为“实用API”
2. 另一个API**负责数据交付以及根据消费者的需求进行格式化**，称为“消费者API”

#### 约定/规则:

1. **“实用API”不能被消费者直接调用；**

2. **只有“消费者API”才能调用“实用API”**



### 可发现

一个消费者应该很容易地找到API组合中的所有API。一个API组合设计需要确保API可被找到，并提供正确使用需要的所有信息。



### 持久性

API在长时间内要保持稳定，定期迭代。



# API组合架构

> 来源：RESTFul API开发实战 P69

多层框架：

- 通过**DAO设计模式**实现的**系统API**

- 通过**服务设计模式**实现的**流程API**
- 通过**API外观设计模式**实现的**体验API**

每一层都是采用软件工程的设计模式实现。



| 对应目标   | 层级                 | 功能                                         | 详情                                                         |
| ---------- | -------------------- | -------------------------------------------- | ------------------------------------------------------------ |
| 应用开发   | 体验API—API外观      | 改编流程API和系统API，为应用提供定制的微服务 | 对应用开发人员有用，提供良好的APX(API体验)。                 |
| LoB开发/IT | 流程API—服务层       | 编织和编排系统API                            | 服务层附着物实现应用的业务逻辑(可重用逻辑)：**流程特定的逻辑**和通过编排**与系统API交互的逻辑**。 |
| 核心IT     | 系统API—数据访问对象 | 封装核心业务能力的微服务                     | 系统API或者系统级服务与自主服务的概念相一致，系统API设计的抽象性足以隐藏底层的记录系统，例如数据库、遗留系统、SaaS应用、DAO。 |





------

# 补充：

一个完整的API解决方案中，利益相关者包括API提供者、API消费者以及最终用户。

### API提供者

API提供者负责开发、设计、部署和管理API。

API提供者定义了API组合、路线图以及产品模式。此外还有一个指责是：决定哪些功能通过API公开给API消费者。

在解决方案驱动的方法中，API提供者往往只构建消费者所需的API。从自顶向下的方法中，API提供者则从内部的角度（如可重用性角度）考虑提供API。

**我的理解：侧重后端和DB**



### API消费者

API消费者需要知道如何**调用API构建一个API客户端**。API提供者应该提供一个演示应用以便API消费者学习如何使用他们的API

**我的理解：**

- 侧重前端和后端（与API调用有关的部分），API调用可以在前端或者后端，也可以二者都有。
- **如果不用render、模版引擎、渲染等，全部采用jQuery的ajax去调用后端的API，尝试方案？**



### 最终用户

最终用户就是一般用户，并不直接调用API，而是使用API消费者开发的应用程序来调用API。



# 